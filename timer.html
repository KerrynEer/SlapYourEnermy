<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 10</title>
    <title>Slap your enemy></title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>

</head>
<body>

<script type="text/javascript">

var config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 300 },
            debug: false
        }
    },
    scene: {
       preload: preload,
        create: create,
        update: update
    }
};

var image;

var timedEvent;
var timeText;
var s;

var game = new Phaser.Game(config);

function preload() {

    this.load.image('background', 'assets/greenblue.jpg');

}

var giventime = 60000;//30 seconds 

function create() {

    image = this.add.image(400, 300, 'greenblue');

        //TIMER
        var giventime = 60000; //1 minute
        var progress;
        var timeLeftInSeconds;

        timeText = this.add.text(100, 100, "01:00",  {fontSize: '32px', fill: '#800000',});
        //After delay seconds, the callback will be invoked and internally the event will be recycled for later use.
        timedEvent = this.time.addEvent({ 
            delay: 3000, 
            callback: onEvent, 
            args: [], 
            callbackScope: this,
            loop: false,
            repeat: 0,
            startAt: 0,
            paused: false
        });

    }

    //add leading zeros to any number less than 10
    function addZeros(num) {
            if (num < 10) {
                num = "0" + num;
            }
            return num;
    }

    function updateTime(){
        
        //elapsed time
        progress = timedEvent.getElapsedSeconds();
        //timedEvent.getProgress()/1000;   
        timeLeftInSeconds = (giventime/1000) - progress;
        //find how many complete min are left
        var minutes = Math.floor(timeLeftInSeconds/60);
        //find the no. of seconds left (not countig the minutes)
        var seconds = Math.floor(timeLeftInSeconds - (minutes*60));
        //a string that shows the time
        var timeString = addZeros(minutes) + ":" + addZeros(seconds);
       

        timeText.setText(timeString);
    }

    function onEvent ()
    {
        image.setScale(0.5);
         //check if the time is up
         if (timeLeftInSeconds == 0){
            //remove timer from the game
            timer.remove();
            //add other code here
            timeText.setText("Time's Up!");
        } else {
            timeLeftInSeconds = timeLeftInSeconds + 5;
            var timer = scene.time.addEvent({
                delay: timeLeftInSeconds,                // ms
                callback: callback,
                //args: [],
                callbackScope: thisArg,
                repeat: 4
});
        }
    }


function update ()
{
    updateTime();
}

//add leading zeros to any number less than 10
function addZeros(num) {
        if (num < 10) {
            num = "0" + num;
        }
        return num;
}


</script>


</body>
</html>